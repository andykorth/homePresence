<!DOCTYPE HTML>
<html>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<body width="100%" height="100%" align="center" bgcolor="teal">

<H1><font color="white">
    Home Presence Monitor
    </font>
</H1>

    <br><br>
    <button id="RedOn" onclick="led('l1', 'HIGH')">Red On</button>
    <button id="RedOff"  onclick="led('l1', 'LOW')">Red Off</button>
    <button id="GreenOn" onclick="led('l2', 'HIGH')">Green On</button>
    <button id="GreenOff"  onclick="led('l2', 'LOW')">Green Off</button>
    <button id="ResetCounter" onclick="resetCounter()">Reset Counter</button>
    <br><br>
    <P><font color="white">Current State Change Count: <span id="stateChanges">No connection yet. Check yer wifi</span></font><br>

    <table cellspacing="0" align="center">
        <tr>
            <td width="100px" height="30px" align="center" bgcolor="lightgray"><b>Resident<b></td>
            <td width="100px" height="30px" align="center" bgcolor="lightgray"><b>Status<b></td>
        <tr>
            <td width="100px" height="30px" align="center" bgcolor="lightblue">Captain Faceman</td>
            <td id="CaptainFaceman" align="center" bgcolor="beige">Unknown</td>
            </tr>
        <tr>
            <td width="100px" height="30px" align="center" bgcolor="lightblue">Jorge</td>
            <td id="Jorge" align="center" bgcolor="beige">Unknown</td>
        </tr>
        <tr>
            <td width="100px" height="30px" align="center" bgcolor="lightblue">The Stickler</td>
            <td id="TheStickler" align="center" bgcolor="beige">Unknown</td>
            </tr>
        <tr>
        <tr>
            <td width="100px" height="30px" align="center" bgcolor="lightblue">Cardla</td>
            <td id="Cardla" align="center" bgcolor="beige">Unknown</td>
            </tr>
        <tr>
        <tr>
            <td width="100px" height="30px" align="center" bgcolor="lightblue">Baby Bertha</td>
            <td id="BabyBertha" align="center" bgcolor="beige">Unknown</td>
            </tr>
    </table>
    <script type="text/javascript">
      var deviceID    = "53ff6e066667574848470967";
      var accessToken = "01c5f7b2d98633a65068351fd2a830c083c144cc";
      var setFunc = "led";
      var getFunc = "count";

      window.setInterval(updateStateChanges, 1000);
      
    function led(light, state) {
        sparkSetLedState(light, state);
        updateStateChanges();
    }
    
    function resetCounter() {
        requestURL = "https://api.spark.io/v1/devices/" +deviceID + "/resetCounter/";
        $.post( requestURL, {access_token: accessToken });
        
    }
    
    function updateStateChanges() {
        requestURL = "https://api.spark.io/v1/devices/" + deviceID + "/count/?access_token=" + accessToken;
        $.getJSON(requestURL, function(json) {
            document.getElementById("stateChanges").innerHTML = json.result;
            document.getElementById("stateChanges").style.fontSize = "28px";
        });

        requestURL = "https://api.spark.io/v1/devices/" + deviceID + "/CaptainFaceman/?access_token=" + accessToken;
        $.getJSON(requestURL, function(json) {
            if(json.result==0){
                document.getElementById("CaptainF").bgColor = "green";
                document.getElementById("CaptainF").innerHTML = "Home";
            }else{
                document.getElementById("CaptainF").bgColor = "red";
                document.getElementById("CaptainF").innerHTML = "Away";
            }
        });
        requestURL = "https://api.spark.io/v1/devices/" + deviceID + "/Jorge/?access_token=" + accessToken;
        $.getJSON(requestURL, function(json) {
            if(json.result==0){
                document.getElementById("Jorge").bgColor = "green";
                document.getElementById("Jorge").innerHTML = "Home";
            }else{
                document.getElementById("Jorge").bgColor = "red";
                document.getElementById("Jorge").innerHTML = "Away";
            }
        });
        requestURL = "https://api.spark.io/v1/devices/" + deviceID + "/TheStickler/?access_token=" + accessToken;
        $.getJSON(requestURL, function(json) {
            if(json.result==0){
                document.getElementById("TheStickler").bgColor = "green";
                document.getElementById("TheStickler").innerHTML = "Home";
            }else{
                document.getElementById("TheStickler").bgColor = "red";
                document.getElementById("TheStickler").innerHTML = "Away";
            }
        });
        requestURL = "https://api.spark.io/v1/devices/" + deviceID + "/Cardla/?access_token=" + accessToken;
        $.getJSON(requestURL, function(json) {
            if(json.result==0){
                document.getElementById("Cardla").bgColor = "green";
                document.getElementById("Cardla").innerHTML = "Home";
            }else{
                document.getElementById("Cardla").bgColor = "red";
                document.getElementById("Cardla").innerHTML = "Away";
            }
        });
        requestURL = "https://api.spark.io/v1/devices/" + deviceID + "/BabyBertha/?access_token=" + accessToken;
        $.getJSON(requestURL, function(json) {
            if(json.result==0){
                document.getElementById("BabyBertha").bgColor = "green";
                document.getElementById("BabyBertha").innerHTML = "Home";
            }else{
                document.getElementById("BabyBertha").bgColor = "red";
                document.getElementById("BabyBertha").innerHTML = "Away";
            }
        });

    }
    
    function sparkSetLedState(ledNumber, state) {
        var requestURL = "https://api.spark.io/v1/devices/" +deviceID + "/" + setFunc + "/";
        $.post( requestURL, { params: ledNumber + "," + state, access_token: accessToken });
    }
    
    </script>
</body>
</html>



